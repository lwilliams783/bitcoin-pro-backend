<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Pro - Market Intelligence</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { text-align: center; padding: 25px; background: rgba(0,0,0,0.3); border-radius: 20px; margin-bottom: 25px; }
        h1 { font-size: 2.8em; margin-bottom: 10px; }
        h2 { font-size: 1.5em; margin-bottom: 20px; }
        .status { display: inline-block; padding: 10px 20px; border-radius: 25px; font-size: 0.9em; font-weight: bold; margin-top: 10px; }
        .status.live { background: rgba(16, 185, 129, 0.3); border: 3px solid #10b981; }
        .status.error { background: rgba(239, 68, 68, 0.3); border: 3px solid #ef4444; }
        .card { background: rgba(255,255,255,0.15); border-radius: 20px; padding: 30px; margin-bottom: 25px; }
        .indicator-card { background: rgba(255,255,255,0.1); border-radius: 15px; padding: 25px; margin-bottom: 20px; border-left: 5px solid transparent; }
        .indicator-card.bullish { border-left-color: #10b981; background: rgba(16, 185, 129, 0.15); }
        .indicator-card.bearish { border-left-color: #ef4444; background: rgba(239, 68, 68, 0.15); }
        .indicator-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .indicator-name { font-size: 1.3em; font-weight: bold; }
        .indicator-value { font-size: 2em; font-weight: bold; }
        .indicator-impact { background: rgba(0,0,0,0.3); border-radius: 10px; padding: 15px; margin-top: 15px; font-size: 0.95em; line-height: 1.6; }
        .impact-label { font-weight: bold; margin-bottom: 8px; display: block; }
        .correlation-strength { display: inline-block; padding: 5px 12px; border-radius: 15px; font-size: 0.85em; font-weight: bold; margin-top: 10px; }
        .correlation-high { background: #10b981; }
        .correlation-medium { background: #f59e0b; }
        .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 15px; }
        .stat-box { background: rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; text-align: center; }
        .stat-box.highlight { border: 2px solid #10b981; background: rgba(16, 185, 129, 0.2); }
        .stat-value { font-size: 1.8em; font-weight: bold; margin-bottom: 8px; }
        .stat-label { font-size: 0.85em; opacity: 0.9; }
        .prediction-card { background: rgba(255,255,255,0.1); border-radius: 15px; padding: 25px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .prediction-card.bullish { border-left: 5px solid #10b981; }
        .prediction-card.bearish { border-left: 5px solid #ef4444; }
        .prediction-card.neutral { border-left: 5px solid #f59e0b; }
        .rrp-section { background: rgba(139, 92, 246, 0.2); border: 3px solid #8b5cf6; border-radius: 20px; padding: 30px; margin-top: 25px; }
        .rrp-explainer { background: rgba(0,0,0,0.3); border-radius: 15px; padding: 20px; margin-top: 20px; }
        .fed-section { background: rgba(59, 130, 246, 0.2); border: 2px solid #3b82f6; border-radius: 20px; padding: 25px; margin-top: 25px; }
        .fed-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px; }
        .fed-box { background: rgba(0,0,0,0.3); border-radius: 12px; padding: 20px; text-align: center; }
        button { width: 100%; background: rgba(16, 185, 129, 0.3); border: 3px solid #10b981; color: white; padding: 18px; border-radius: 15px; font-size: 1.1em; font-weight: bold; cursor: pointer; margin-top: 25px; }
        button:hover { background: rgba(16, 185, 129, 0.5); }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Bitcoin Pro</h1>
            <p style="font-size: 1.1em; margin: 5px 0;">Market Intelligence & Correlation Analysis</p>
            <div id="statusBadge" class="status live">üü¢ LIVE</div>
            <p style="font-size: 0.85em; margin-top: 10px; opacity: 0.8;">Last Update: <span id="lastUpdate">--</span></p>
        </div>

```
    <div class="card">
        <h2 style="text-align: center;">‚ö° Bitcoin Live Price</h2>
        <div style="text-align: center; font-size: 3.5em; font-weight: bold; color: #10b981; margin: 20px 0;" id="btcPrice">$--</div>
        <div class="stat-grid">
            <div class="stat-box highlight">
                <div class="stat-value" id="btcChange">--</div>
                <div class="stat-label">24h Change</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="btcVolume">--</div>
                <div class="stat-label">24h Volume</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="btcMarketCap">--</div>
                <div class="stat-label">Market Cap</div>
            </div>
        </div>
    </div>

    <div class="card">
        <h2 style="text-align: center;">üìÖ Market Outlook</h2>
        <div id="dailyPrediction" class="prediction-card neutral">
            <div>
                <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 8px;">DAILY (24h)</div>
                <div style="font-size: 2.5em; margin-bottom: 5px;">‚ö™</div>
                <div style="font-size: 1.5em; font-weight: bold;">LOADING...</div>
            </div>
            <div style="font-size: 2em; font-weight: bold;">--</div>
        </div>
        <div id="weeklyPrediction" class="prediction-card neutral">
            <div>
                <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 8px;">WEEKLY (7 days)</div>
                <div style="font-size: 2.5em; margin-bottom: 5px;">‚ö™</div>
                <div style="font-size: 1.5em; font-weight: bold;">LOADING...</div>
            </div>
            <div style="font-size: 2em; font-weight: bold;">--</div>
        </div>
        <div id="monthlyPrediction" class="prediction-card neutral">
            <div>
                <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 8px;">MONTHLY (30 days)</div>
                <div style="font-size: 2.5em; margin-bottom: 5px;">‚ö™</div>
                <div style="font-size: 1.5em; font-weight: bold;">LOADING...</div>
            </div>
            <div style="font-size: 2em; font-weight: bold;">--</div>
        </div>
    </div>

    <div class="card">
        <h2>üåç How Markets Affect Bitcoin</h2>
        <p style="opacity: 0.9; margin-bottom: 25px; font-size: 1.05em;">Understanding the correlations between Bitcoin and traditional markets</p>

        <div id="spxCard" class="indicator-card">
            <div class="indicator-header">
                <div class="indicator-name">üìä S&P 500</div>
                <div class="indicator-value" id="spxValue">--</div>
            </div>
            <div id="spxStatus" style="font-size: 1.1em; font-weight: bold;">--</div>
            <div class="indicator-impact">
                <span class="impact-label">üí° How It Affects Bitcoin:</span>
                When S&P 500 rises, it signals "risk-on" investor sentiment. Money flows into risk assets like stocks AND Bitcoin. When S&P falls, investors flee to cash/bonds, often selling Bitcoin too.
                <div class="correlation-strength correlation-high">‚ö° HIGH CORRELATION</div>
            </div>
        </div>

        <div id="dxyCard" class="indicator-card">
            <div class="indicator-header">
                <div class="indicator-name">üíµ DXY (US Dollar Index)</div>
                <div class="indicator-value" id="dxyValue">--</div>
            </div>
            <div id="dxyStatus" style="font-size: 1.1em; font-weight: bold;">--</div>
            <div class="indicator-impact">
                <span class="impact-label">üí° How It Affects Bitcoin:</span>
                <strong>INVERSE correlation.</strong> When the dollar strengthens (DXY up), Bitcoin often falls because it's priced in dollars. Weak dollar (DXY down) = Bitcoin typically rises. Think of Bitcoin as "anti-dollar."
                <div class="correlation-strength correlation-high">‚ö° HIGH CORRELATION (Inverse)</div>
            </div>
        </div>

        <div id="goldCard" class="indicator-card">
            <div class="indicator-header">
                <div class="indicator-name">ü•á Gold</div>
                <div class="indicator-value" id="goldValue">--</div>
            </div>
            <div id="goldStatus" style="font-size: 1.1em; font-weight: bold;">--</div>
            <div class="indicator-impact">
                <span class="impact-label">üí° How It Affects Bitcoin:</span>
                Both are "stores of value." When gold rises moderately ($2600-3000), it shows inflation fears = bullish for Bitcoin. Extreme gold prices (>$3000) often mean panic = bearish for risk assets like Bitcoin.
                <div class="correlation-strength correlation-medium">üìä MEDIUM CORRELATION</div>
            </div>
        </div>

        <div id="rutCard" class="indicator-card">
            <div class="indicator-header">
                <div class="indicator-name">üè¢ Russell 2000 (Small Caps)</div>
                <div class="indicator-value" id="rutValue">--</div>
            </div>
            <div id="rutStatus" style="font-size: 1.1em; font-weight: bold;">--</div>
            <div class="indicator-impact">
                <span class="impact-label">üí° How It Affects Bitcoin:</span>
                Russell 2000 = small company stocks = ultimate "risk-on" indicator. When it's strong (>2500), investors are taking BIG risks = bullish for Bitcoin. When weak, investors play it safe = bearish for Bitcoin.
                <div class="correlation-strength correlation-high">‚ö° HIGH CORRELATION</div>
            </div>
        </div>

        <div id="vixCard" class="indicator-card">
            <div class="indicator-header">
                <div class="indicator-name">üò® VIX (Fear Index)</div>
                <div class="indicator-value" id="vixValue">--</div>
            </div>
            <div id="vixStatus" style="font-size: 1.1em; font-weight: bold;">--</div>
            <div class="indicator-impact">
                <span class="impact-label">üí° How It Affects Bitcoin:</span>
                VIX measures market fear. Low VIX (<20) = calm markets = investors comfortable taking risks = bullish for Bitcoin. High VIX (>30) = panic = investors sell everything including Bitcoin.
                <div class="correlation-strength correlation-high">‚ö° HIGH CORRELATION (Inverse)</div>
            </div>
        </div>
    </div>

    <div class="rrp-section">
        <h2>üíß Reverse Repo (RRP) - The Liquidity Meter</h2>
        <div style="text-align: center; margin: 20px 0;">
            <div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 10px;">Current RRP Balance</div>
            <div style="font-size: 3.5em; font-weight: bold; color: #a78bfa;" id="rrpValue">$--</div>
            <div id="rrpStatus" style="font-size: 1.3em; font-weight: bold; margin-top: 10px;">--</div>
        </div>
        <div class="rrp-explainer">
            <h3 style="margin-bottom: 15px; font-size: 1.2em;">üéì What Is RRP?</h3>
            <p style="line-height: 1.8; margin-bottom: 15px;">
                The <strong>Reverse Repo (RRPONTSYD)</strong> is where banks and money market funds park their cash overnight with the Federal Reserve. Think of it as the Fed's "savings account."
            </p>
            <h3 style="margin: 20px 0 15px 0; font-size: 1.2em;">üìä Why It Matters for Bitcoin:</h3>
            <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; line-height: 1.8;">
                <strong>üí∞ HIGH RRP (>$500B):</strong> Lots of cash parked at the Fed = LESS liquidity in markets = BEARISH for Bitcoin
                <br><br>
                <strong>üöÄ LOW RRP (<$300B):</strong> Less cash parked = MORE liquidity flowing into markets = BULLISH for Bitcoin
                <br><br>
                <strong>üéØ Current Status:</strong> <span id="rrpExplain">Analyzing...</span>
            </div>
            <div class="correlation-strength correlation-high" style="margin-top: 15px;">‚ö° HIGH IMPACT ON BITCOIN</div>
        </div>
    </div>

    <div class="fed-section">
        <h2>üè¶ Federal Reserve Policy Dashboard</h2>
        <div class="fed-grid">
            <div class="fed-box">
                <div style="opacity: 0.8; font-size: 0.85em;">Fed Funds Rate</div>
                <div style="font-size: 2em; font-weight: bold; margin: 10px 0;" id="fedRate">--%</div>
                <div style="font-size: 0.8em; opacity: 0.8;">Higher = Bearish</div>
            </div>
            <div class="fed-box">
                <div style="opacity: 0.8; font-size: 0.85em;">Rate Cut Probability</div>
                <div style="font-size: 2em; font-weight: bold; margin: 10px 0; color: #3b82f6;" id="cutProb">--%</div>
                <div style="font-size: 0.75em; margin-top: 5px;">Next: <span id="nextMeeting">--</span></div>
            </div>
            <div class="fed-box">
                <div style="opacity: 0.8; font-size: 0.85em;">Balance Sheet</div>
                <div style="font-size: 2em; font-weight: bold; margin: 10px 0;" id="fedBalance">$--B</div>
                <div id="qtStatus" style="font-size: 0.85em; padding: 5px 10px; border-radius: 15px; display: inline-block; margin-top: 5px;">--</div>
            </div>
        </div>
        <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; margin-top: 20px; line-height: 1.7;">
            <strong>üí° What This Means:</strong><br>
            <strong>QT (Tightening):</strong> Fed shrinking balance sheet = draining liquidity = Bearish for Bitcoin<br>
            <strong>QE (Easing):</strong> Fed expanding balance sheet = adding liquidity = Bullish for Bitcoin
        </div>
    </div>

    <button onclick="fetchMarketData()">üîÑ Refresh Now</button>

    <div style="text-align: center; padding: 25px; opacity: 0.7; font-size: 0.85em;">
        <p>üìä Auto-updates every 5 seconds</p>
        <p style="font-size: 0.8em; margin-top: 10px;">‚ö†Ô∏è Not financial advice ‚Ä¢ Educational purposes only</p>
    </div>
</div>

<script>
    const BACKEND_URL = "https://bitcoin-pro-backend.onrender.com";
    let ws = null;

    // Initialize Binance WebSocket for REAL-TIME Bitcoin price
    function initBinanceWebSocket() {
        try {
            ws = new WebSocket('wss://stream.binance.com:9443/ws/btcusdt@trade');
            
            ws.onopen = () => {
                console.log('‚úÖ Binance WebSocket connected - Real-time BTC active!');
            };
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                const price = Math.round(parseFloat(data.p)); // Trade price
                const volume = parseFloat(data.q || 0); // Quantity
                
                // Update Bitcoin price INSTANTLY
                document.getElementById("btcPrice").textContent = "$" + price.toLocaleString();
                
                console.log('üî• BTC Price Update:', price);
            };
            
            ws.onerror = (error) => {
                console.error('‚ùå Binance WebSocket error:', error);
            };
            
            ws.onclose = () => {
                console.log('‚ö†Ô∏è Binance WebSocket closed, reconnecting in 5s...');
                setTimeout(initBinanceWebSocket, 5000);
            };
        } catch (error) {
            console.error('Failed to initialize Binance WebSocket:', error);
        }
    }

    function calculatePrediction(price, change, days) {
        const volatility = Math.abs(change) / 100;
        const trend = change > 0 ? 1 : -1;
        const prediction = price * (1 + (trend * volatility * days * (Math.random() * 0.3 + 0.7)));
        const pctChange = ((prediction - price) / price) * 100;
        let sentiment, emoji, className;
        if (pctChange > 5) { sentiment = "VERY BULLISH"; emoji = "üöÄ"; className = "bullish"; }
        else if (pctChange > 0) { sentiment = "BULLISH"; emoji = "üìà"; className = "bullish"; }
        else if (pctChange > -5) { sentiment = "BEARISH"; emoji = "üìâ"; className = "bearish"; }
        else { sentiment = "VERY BEARISH"; emoji = "‚ö†Ô∏è"; className = "bearish"; }
        return { price: Math.round(prediction), sentiment, emoji, className };
    }

    async function fetchMarketData() {
        try {
            document.getElementById("statusBadge").className = "status live";
            document.getElementById("statusBadge").textContent = "üü¢ LIVE";

            const response = await fetch(`${BACKEND_URL}/markets`);
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            const data = await response.json();

            document.getElementById("lastUpdate").textContent = new Date().toLocaleTimeString();

            // Update Bitcoin data from backend (WebSocket only shows trade price)
            if (data.bitcoin && data.bitcoin.price) {
                document.getElementById("btcPrice").textContent = "$" + data.bitcoin.price.toLocaleString();
                const changeEl = document.getElementById("btcChange");
                changeEl.textContent = (data.bitcoin.change24h > 0 ? "+" : "") + data.bitcoin.change24h + "%";
                changeEl.style.color = data.bitcoin.change24h >= 0 ? "#10b981" : "#ef4444";
                document.getElementById("btcVolume").textContent = "$" + data.bitcoin.volume24h + "B";
                document.getElementById("btcMarketCap").textContent = "$" + data.bitcoin.marketCap + "T";
            }

            const daily = calculatePrediction(data.bitcoin.price, data.bitcoin.change24h, 1);
            const weekly = calculatePrediction(data.bitcoin.price, data.bitcoin.change24h, 7);
            const monthly = calculatePrediction(data.bitcoin.price, data.bitcoin.change24h, 30);

            document.getElementById("dailyPrediction").className = "prediction-card " + daily.className;
            document.getElementById("dailyPrediction").innerHTML = `<div><div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 8px;">DAILY (24h)</div><div style="font-size: 2.5em; margin-bottom: 5px;">${daily.emoji}</div><div style="font-size: 1.5em; font-weight: bold;">${daily.sentiment}</div></div><div style="font-size: 2em; font-weight: bold;">$${daily.price.toLocaleString()}</div>`;

            document.getElementById("weeklyPrediction").className = "prediction-card " + weekly.className;
            document.getElementById("weeklyPrediction").innerHTML = `<div><div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 8px;">WEEKLY (7 days)</div><div style="font-size: 2.5em; margin-bottom: 5px;">${weekly.emoji}</div><div style="font-size: 1.5em; font-weight: bold;">${weekly.sentiment}</div></div><div style="font-size: 2em; font-weight: bold;">$${weekly.price.toLocaleString()}</div>`;

            document.getElementById("monthlyPrediction").className = "prediction-card " + monthly.className;
            document.getElementById("monthlyPrediction").innerHTML = `<div><div style="font-size: 0.9em; opacity: 0.9; margin-bottom: 8px;">MONTHLY (30 days)</div><div style="font-size: 2.5em; margin-bottom: 5px;">${monthly.emoji}</div><div style="font-size: 1.5em; font-weight: bold;">${monthly.sentiment}</div></div><div style="font-size: 2em; font-weight: bold;">$${monthly.price.toLocaleString()}</div>`;

            const m = data.marketData;
            
            document.getElementById("spxValue").textContent = m.spx.toLocaleString();
            document.getElementById("spxStatus").textContent = m.spx > 5700 ? "‚úÖ RISK-ON (Bullish for BTC)" : "‚ùå RISK-OFF (Bearish for BTC)";
            document.getElementById("spxCard").className = m.spx > 5700 ? "indicator-card bullish" : "indicator-card bearish";

            document.getElementById("dxyValue").textContent = m.dxy;
            document.getElementById("dxyStatus").textContent = m.dxy < 105 ? "‚úÖ WEAK DOLLAR (Bullish for BTC)" : "‚ùå STRONG DOLLAR (Bearish for BTC)";
            document.getElementById("dxyCard").className = m.dxy < 105 ? "indicator-card bullish" : "indicator-card bearish";

            document.getElementById("goldValue").textContent = "$" + m.gold;
            const goldBullish = m.gold > 2600 && m.gold < 3000;
            document.getElementById("goldStatus").textContent = goldBullish ? "‚úÖ SWEET SPOT (Bullish for BTC)" : "‚ùå EXTREME LEVELS (Bearish for BTC)";
            document.getElementById("goldCard").className = goldBullish ? "indicator-card bullish" : "indicator-card bearish";

            document.getElementById("rutValue").textContent = m.rut.toLocaleString();
            document.getElementById("rutStatus").textContent = m.rut > 2500 ? "‚úÖ STRONG RISK APPETITE (Bullish for BTC)" : "‚ùå WEAK RISK APPETITE (Bearish for BTC)";
            document.getElementById("rutCard").className = m.rut > 2500 ? "indicator-card bullish" : "indicator-card bearish";

            document.getElementById("vixValue").textContent = m.vix;
            document.getElementById("vixStatus").textContent = m.vix < 20 ? "‚úÖ LOW FEAR (Bullish for BTC)" : "‚ùå HIGH FEAR (Bearish for BTC)";
            document.getElementById("vixCard").className = m.vix < 20 ? "indicator-card bullish" : "indicator-card bearish";

            document.getElementById("rrpValue").textContent = "$" + data.fedData.rrp + "B";
            const rrpBullish = data.fedData.rrp < 300;
            document.getElementById("rrpStatus").textContent = rrpBullish ? "‚úÖ HIGH LIQUIDITY (Bullish for BTC)" : "‚ùå LOW LIQUIDITY (Bearish for BTC)";
            
            if (data.fedData.rrp < 200) {
                document.getElementById("rrpExplain").textContent = "üöÄ VERY LOW - Massive liquidity in markets! Extremely bullish for Bitcoin.";
            } else if (data.fedData.rrp < 300) {
                document.getElementById("rrpExplain").textContent = "‚úÖ LOW - Good liquidity flowing into markets. Bullish for Bitcoin.";
            } else if (data.fedData.rrp < 500) {
                document.getElementById("rrpExplain").textContent = "‚öñÔ∏è MODERATE - Neutral liquidity conditions.";
            } else {
                document.getElementById("rrpExplain").textContent = "‚ùå HIGH - Too much cash parked at Fed. Bearish for Bitcoin.";
            }

            document.getElementById("fedRate").textContent = data.fedData.fedFunds.toFixed(2) + "%";
            document.getElementById("cutProb").textContent = (data.fedData.fedCutProbability * 100).toFixed(0) + "%";
            document.getElementById("nextMeeting").textContent = data.fedData.nextMeetingDate;
            document.getElementById("fedBalance").textContent = "$" + data.fedData.fedBalance + "B";
            
            const qtEl = document.getElementById("qtStatus");
            if (data.fedData.qtActive) {
                qtEl.textContent = "üî¥ QT Active (Bearish)";
                qtEl.style.background = "#ef4444";
                qtEl.style.color = "white";
            } else {
                qtEl.textContent = "üü¢ QE Active (Bullish)";
                qtEl.style.background = "#10b981";
                qtEl.style.color = "white";
            }

        } catch (error) {
            console.error("Error:", error);
            document.getElementById("statusBadge").className = "status error";
            document.getElementById("statusBadge").textContent = "üî¥ ERROR";
        }
    }

    window.addEventListener("load", () => {
        initBinanceWebSocket(); // Start real-time Bitcoin feed
        fetchMarketData(); // Fetch other market data
        setInterval(fetchMarketData, 5000); // Update macro data every 5 seconds
    });
</script>
```

</body>
</html>
